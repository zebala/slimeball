(function(f){var g={width:730,height:375,groundHeight:75,slimeRadius:37,ballDiameter:22,ballRadius:11,goalHeight:75,goalWidth:40},e={slime:300,jump:325,ballMaxSpeed:750,gravity:1250},a={left:-1,right:1},d=function(c){c=f.extend({},{size:g,speed:e},c);this.size=c.size;this.speed=c.speed;this.direction=a;this.stage=SoccerSlime.Stage(this);this.ball=SoccerSlime.Ball(this);this.teams=[];this.slimes=[];this.teams.push(SoccerSlime.Team(this,"Red","#FF0000","left").addPlayer({up:"w",left:"a",right:"d"}));
this.teams.push(SoccerSlime.Team(this,"Green","#009900","right").addPlayer({up:"up",left:"left",right:"right"}));this.jumbotron=SoccerSlime.Jumbotron(this);this.keys=SoccerSlime.Keys(this);this.mode=SoccerSlime.Mode(this);this.updater=SoccerSlime.Updater(this);this.init()};d.prototype.init=function(){this.teams[0].init();this.teams[1].init();this.ball.init()};window&&(window.SoccerSlime={},window.SoccerSlime.Game=function(a){return new d(a)})})(jQuery);
(function(f){function g(a){return function(){var d=this.getContext(),c=a.game.size;d.beginPath();d.arc(0,0,c.slimeRadius,0,Math.PI,!0);d.closePath();var b=d.createRadialGradient(0,-c.slimeRadius,0,0,-c.slimeRadius,c.slimeRadius);b.addColorStop(0,"#FFFFFF");b.addColorStop(1,a.color);d.fillStyle=b;d.fill();b=c.slimeRadius/5;d.beginPath();d.arc((c.slimeRadius-b)/Math.sqrt(2)*a.direction,-(c.slimeRadius-b)/Math.sqrt(2),b,0,2*Math.PI,!0);d.fillStyle="white";d.fill();var k=a.ball.obj.getY()-a.obj.getY()+
(c.slimeRadius-b)/Math.sqrt(2),e=a.ball.obj.getX()-a.obj.getX()-(c.slimeRadius-b)/Math.sqrt(2)*a.direction,k=Math.atan2(k,e);d.beginPath();d.arc((c.slimeRadius-b)/Math.sqrt(2)*a.direction+b/2*Math.cos(k),-(c.slimeRadius-b)/Math.sqrt(2)+b/2*Math.sin(k),b/2,0,2*Math.PI,!0);d.fillStyle="black";d.fill()}}var e=function(a,d,c){this.game=a;this.color=d;this.ball=a.ball;this.direction=1;this.keys=c;this.obj=new Kinetic.Shape({drawFunc:g(this)});a.stage.gameLayer.add(this.obj);this.init()};e.prototype.init=
function(){this.vy=this.vx=0;return this};e.prototype.update=function(a){var d=this.game.keys,c=this.game.size,b=this.game.speed,k=this.game.direction;this.vx=0;d.isDown(this.keys.left)&&(this.vx=-b.slime,this.direction=k.left);d.isDown(this.keys.right)&&(this.vx=b.slime,this.direction=k.right);d.isHit(this.keys.up)&&this.obj.getY()===c.height-c.groundHeight&&(this.vy=-b.jump);this.obj.setPosition(Math.min(Math.max(this.obj.getX()+this.vx*a/1E3,c.slimeRadius),c.width-c.slimeRadius),this.obj.getY()+
this.vy*a/1E3);this.obj.getY()<c.height-c.groundHeight?this.vy+=b.gravity*a/1E3:(this.vy=0,this.obj.setPosition(this.obj.getX(),c.height-c.groundHeight));return this};SoccerSlime.Slime=function(a,d,c){return new e(a,d,c)}})(jQuery);
(function(f){var g=function(e){var a=e.size;this.obj=new Kinetic.Circle({radius:a.ballRadius,fillRadialGradientStartPoint:[a.ballRadius/2,-a.ballRadius/2],fillRadialGradientEndPoint:[0,0],fillRadialGradientStartRadius:a.ballRadius/10,fillRadialGradientEndRadius:a.ballRadius,fillRadialGradientColorStops:[0,"yellow",1,"#FFCC00"]});this.game=e;this.game.stage.gameLayer.add(this.obj);this.init()};g.prototype.init=function(){var e=this.game.size;this.vy=this.vx=0;this.obj.setPosition(e.width/2,e.height-
e.groundHeight-0.4*e.height);return this};g.prototype.update=function(e){var a=this.obj.getX(),d=this.obj.getY(),c=d,b=this.game.size,k=this.game.speed,m=Math.atan2(this.vy,this.vx),g=Math.min(Math.sqrt(Math.pow(this.vx,2)+Math.pow(this.vy,2)),k.ballMaxSpeed)*Math.pow(0.8,e/1E3);this.vx=g*Math.cos(m);this.vy=g*Math.sin(m);a+=this.vx*e/1E3;d+=this.vy*e/1E3;d+b.ballRadius<b.height-b.groundHeight?this.vy+=k.gravity*e/1E3:(d=b.height-b.groundHeight-b.ballRadius,this.vy=-this.vy/2);a<b.ballRadius&&(a=
b.ballRadius+(b.ballRadius-a)/2,this.vx=-this.vx/2);a>b.width-b.ballRadius&&(a=b.width-b.ballRadius-(b.width-b.ballRadius-a)/2,this.vx=-this.vx/2);for(var f=this.game.slimes,h=0;h<f.length;h++)if(m=Math.atan2(this.vy,this.vx),g=Math.min(Math.sqrt(Math.pow(this.vx,2)+Math.pow(this.vy,2)),k.ballMaxSpeed),Math.sqrt(Math.pow(f[h].obj.getX()-a,2)+Math.pow(f[h].obj.getY()-d,2))<b.slimeRadius+b.ballRadius&&d<f[h].obj.getY()){var l=Math.atan2(d-f[h].obj.getY(),a-f[h].obj.getX()),p=(a-f[h].obj.getX())*Math.cos(-m)+
(d-f[h].obj.getY())*Math.sin(-m),n=-Math.pow(b.slimeRadius+b.ballRadius,2)+Math.pow(a,2)-a*f[h].obj.getX()+Math.pow(f[h].obj.getX(),2)+Math.pow(d,2)-d*f[h].obj.getY()+Math.pow(f[h].obj.getY(),2),n=Math.pow(p,2)-4*n;0<=n?(l=(-p+Math.sqrt(n))/2,a+=l*cos(-m),d+=l*sin(-m)):(a=f[h].obj.getX()+(b.slimeRadius+b.ballRadius)*Math.cos(l),d=f[h].obj.getY()+(b.slimeRadius+b.ballRadius)*Math.sin(l));l=Math.atan2(d-f[h].obj.getY(),a-f[h].obj.getX());this.vx=g*Math.cos(2*l-m+Math.PI);this.vy=g*Math.sin(2*l-m+Math.PI)-
2*Math.sin(l)*Math.min(0,f[h].vy);if(a>f[h].obj.getX()&&0<f[h].vx||a<f[h].obj.getX()&&0>f[h].vx)this.vx+=Math.abs(Math.cos(l))*f[h].vx;a<b.ballRadius&&(a=b.ballRadius+(b.ballRadius-a)/2,this.vx=-this.vx/2);a>b.width-b.ballRadius&&(a=b.width-b.ballRadius-(b.width-b.ballRadius-a)/2,this.vx=-this.vx/2)}d+b.ballRadius>b.height-b.groundHeight-b.goalHeight&&(c+b.ballRadius<=b.height-b.groundHeight-b.goalHeight&&(a<b.goalWidth||a>b.width-b.goalWidth))&&(d=b.height-b.groundHeight-b.goalHeight-b.ballRadius,
this.vy=-this.vy/2,this.vx+=5*(a<b.width/2?1:-1)*e/1E3);d-b.ballRadius<b.height-b.groundHeight-b.goalHeight&&(c-b.ballRadius>=b.height-b.groundHeight-b.goalHeight&&(a<b.goalWidth||a>b.width-b.goalWidth))&&(d=b.height-b.groundHeight-b.goalHeight+b.ballRadius,this.vy=-this.vy/2);Math.sqrt(Math.pow(b.goalWidth-a,2)+Math.pow(b.height-b.groundHeight-b.goalHeight-d,2))<=b.ballRadius&&(Math.atan2(this.vy,this.vx),this.vx=Math.abs(this.vx),this.vy*=-1);Math.sqrt(Math.pow(b.width-b.goalWidth-a,2)+Math.pow(b.height-
b.groundHeight-b.goalHeight-d,2))<=b.ballRadius&&(Math.atan2(this.vy,this.vx),this.vx=-Math.abs(this.vx),this.vy*=-1);this.obj.setPosition(a,d);return this};SoccerSlime.Ball=function(e){return new g(e)}})(jQuery);
(function(f){var g=function(e,a,d,c){this.game=e;this.name=a;this.color=d;this.direction="right"===c.toLowerCase()?-1:1;this.slimes=[];this.goals=0};g.prototype.addPlayer=function(e){e=SoccerSlime.Slime(this.game,this.color,e);this.slimes.push(e);this.game.slimes.push(e);return this};g.prototype.gameInit=function(){this.init();this.goals=0;return this};g.prototype.init=function(){for(var e=this.game.size,a=(1===this.direction?0:e.width)+this.direction*(e.goalWidth+2*e.slimeRadius),d=0;d<this.slimes.length;d++){var c=
this.slimes[d];c.obj.setPosition(a+(e.width/2-a-e.slimeRadius)/Math.max(1,this.slimes.length-1)*d,e.height-e.groundHeight);c.direction=this.direction;c.init()}return this};g.prototype.score=function(){this.goals+=1};SoccerSlime.Team=function(e,a,d,c){return new g(e,a,d,c)}})(jQuery);
(function(f){function g(b){b=b.size;var a=new Kinetic.Layer;a.add(new Kinetic.Rect({x:0,y:0,width:b.width,height:b.height,fillLinearGradientStartPoint:[0,0],fillLinearGradientEndPoint:[0,b.height],fillLinearGradientColorStops:[0,"white",(b.height-b.groundHeight)/b.height,"blue",(b.height-b.groundHeight+1)/b.height,"#00C800",1,"green"]}));return a}function e(b){var a=b.size;b=new Kinetic.Layer;b.add(new Kinetic.Shape({drawFunc:function(){var b=this.getContext();b.beginPath();for(var c=0;c<=a.goalWidth;c+=
5)b.moveTo(c+0.5,a.height-a.groundHeight-a.goalHeight-0.5),b.lineTo(c+0.5,a.height-a.groundHeight);for(c=a.height-a.groundHeight-a.goalHeight;c<=a.height-a.groundHeight;c+=5)b.moveTo(0.5,c-0.5),b.lineTo(a.goalWidth+0.5,c-0.5);for(c=a.width-a.goalWidth;c<=a.width;c+=5)b.moveTo(c-0.5,a.height-a.groundHeight-a.goalHeight-0.5),b.lineTo(c-0.5,a.height-a.groundHeight);for(c=a.height-a.groundHeight-a.goalHeight;c<=a.height-a.groundHeight;c+=5)b.moveTo(a.width-a.goalWidth-0.5,c-0.5),b.lineTo(a.width,c-0.5);
b.strokeStyle="white";b.lineWidth=1;b.stroke();b.beginPath();b.rect(a.goalWidth-4.5,a.height-a.groundHeight-a.groundHeight-0.5,5,a.goalHeight);b.rect(a.width-a.goalWidth-0.5,a.height-a.groundHeight-a.groundHeight-0.5,5,a.goalHeight);b.rect(0,a.height-a.groundHeight+5,a.goalWidth+a.slimeRadius,5);b.rect(a.width-a.goalWidth-a.slimeRadius,a.height-a.groundHeight+5,a.goalWidth+a.slimeRadius,5);b.fillStyle="white";b.fill();b.stroke()}}));return b}function a(a){a=a.size;var c=new Kinetic.Layer;c.add(new Kinetic.Text({x:0,
y:a.height/2-40,fontSize:85,fontFamily:"Impact",width:a.width,text:"HTML5 Soccer Slime",fill:"white",align:"center",shadowColor:"black",shadowBlur:0.1,shadowOffset:7,shadowOpacity:0.9}));return c}function d(a){a=a.size;var c=new Kinetic.Layer;c.add(new Kinetic.Text({x:0,y:a.height-a.groundHeight-40,fontSize:20,fontFamily:"Arial",width:a.width,text:"Hit space to continue",fill:"white",align:"center"}));return c}var c=function(a){this.game=a;this.init()};c.prototype.init=function(){var b=this.game.size;
this.obj=new Kinetic.Stage({container:"slimecontainer",x:0,y:0,width:b.width,height:b.height});this.gameLayer=new Kinetic.Layer;this.menuLayer=a(this.game);this.continueLayer=d(this.game);b=new Kinetic.Layer;this.bouncingText=new Kinetic.Text({x:0,y:-1E3,fontSize:150,fontFamily:"Impact",width:this.game.size.width,text:"Goal!",fill:"white",align:"center",shadowColor:"black",shadowBlur:0.1,shadowOffset:7,shadowOpacity:0.9});b.add(this.bouncingText);this.obj.add(g(this.game));this.obj.add(this.gameLayer);
this.obj.add(e(this.game));this.obj.add(this.menuLayer);this.obj.add(this.continueLayer);this.obj.add(b);f("#slimecontainer").attr("tabindex","0");f("#slimecontainer").mousedown(function(){f(this).focus();return!1});f("#slimecontainer").css("outline","none");return this};c.prototype.startTextAnimation=function(a){var c=this.game.size,d=this.bouncingText;d.setText(a);d.setPosition(0,-d.getTextHeight());(new Kinetic.Tween({node:d,y:c.height-c.groundHeight-d.getTextHeight(),duration:1.2,easing:Kinetic.Easings.BounceEaseOut,
onFinish:function(){(new Kinetic.Tween({node:d,x:c.width,duration:1.2,easing:Kinetic.Easings.EaseIn})).play()}})).play()};SoccerSlime.Stage=function(a){return new c(a)}})(jQuery);
(function(f){function g(a){return function(d){a.time+=d.timeDiff;a.time>=45E3*a.half&&(a.time=45E3*a.half,a.setHalf(2),a.game.mode("halfTime"),a.animation.stop());a.updateClock()}}var e=function(a){var d=a.size;this.game=a;this.obj=new Kinetic.Layer;this.obj.add(new Kinetic.Rect({x:0,y:0,width:d.width,height:75,fill:"black",opacity:0.7}));this.teamName=[];for(var c=0;2>c;c++)this.teamName[c]=new Kinetic.Text({y:20,fontSize:25,fontFamily:"Arial",fill:"white"}),this.teamName[c].setX(20),this.updateTeam(c),
this.obj.add(this.teamName[c]);this.halfText=new Kinetic.Text({x:0,y:5,width:d.width,align:"center",fontSize:25,fontFamily:"Arial",fill:"white"});this.obj.add(this.halfText);this.setHalf(1);this.clock=new Kinetic.Text({x:0,y:35,width:d.width,align:"center",fontSize:25,fontFamily:"Arial",fill:"white"});this.resetClock();this.obj.add(this.clock);a.stage.obj.add(this.obj);this.animation=new Kinetic.Animation(g(this),this.obj)};f=e.prototype;f.updateTeam=function(a){this.teamName[a].setText(this.game.teams[a].name+
": "+this.game.teams[a].goals);1===a&&this.teamName[a].setX(this.game.size.width-20-this.teamName[a].getWidth())};f.setHalf=function(a){"number"===typeof a&&(this.half=a,this.halfText.setText(a+(1===a?"st":"nd")+" Half"))};f.resetClock=function(){this.time=0;this.updateClock()};f.updateClock=function(){this.clock.setText(Math.floor(this.time/1E3)+":"+(100>this.time%1E3?"0":"")+(10>this.time%1E3?"0":"")+this.time%1E3)};f.startClock=function(){this.animation.start()};f.stopClock=function(){this.animation.stop()};
SoccerSlime.Jumbotron=function(a){return new e(a)}})(jQuery);
(function(f){var g=function(e){this.game=e;this.keyStatus={};this.keyHitStatus={};this.keyMap={left:37,right:39,up:38,space:32,w:87,a:65,d:68};var a=this;f("#slimecontainer").on("keydown",function(d){return a.keyDown(d.which)});f("#slimecontainer").on("keyup",function(d){return a.keyUp(d.which)})};g.prototype.checkKey=function(e){for(var a in this.keyMap)if(this.keyMap[a]===e)return!0;return!1};g.prototype.keyDown=function(e){this.checkKey(e)&&(this.keyHitStatus[e]=this.keyStatus[e]?!1:!0,this.keyStatus[e]=
!0);return!1};g.prototype.keyUp=function(e){this.checkKey(e)&&(this.keyHitStatus[e]=!1,this.keyStatus[e]=!1);return!1};g.prototype.isDown=function(e){return this.keyStatus[this.keyMap[e]]};g.prototype.isHit=function(e){return this.keyHitStatus[this.keyMap[e]]};SoccerSlime.Keys=function(e){return new g(e)}})(jQuery);
(function(f){var g=function(a){this.game=a;this.animation=new Kinetic.Animation(e(a),a.stage.gameLayer);this.animation.start()},e=function(c){return function(b){b=b.timeDiff;switch(c.mode()){case "menu":c.keys.isHit("space")&&c.mode("game");break;case "game":a(c,b);c.ball.update(b);d(c);break;case "goal":a(c,b);c.ball.update(b);break;case "continueGame":c.keys.isHit("space")&&c.mode("game");break;case "halfTime":a(c,b);c.ball.update(b);break;case "test":a(c,b),c.ball.update(b)}}},a=function(a,b){for(var d=
0;d<a.slimes.length;d++)a.slimes[d].update(b)},d=function(a){var b=a.ball,d=a.size,e;b.obj.getX()<d.goalWidth&&b.obj.getY()>d.height-d.groundHeight-d.goalHeight&&(e=1);b.obj.getX()>d.width-d.goalWidth&&b.obj.getY()>d.height-d.groundHeight-d.goalHeight&&(e=0);"undefined"!==typeof e&&(a.teams[e].score(),a.jumbotron.updateTeam(e),a.stage.obj.draw(),a.mode("goal"),setTimeout(function(){a.mode("continueGame")},1500))};SoccerSlime.Updater=function(a){return new g(a)}})(jQuery);
(function(f){var g={menu:0,game:1,goal:2,continueGame:3,halfTime:4,gameOver:5,test:6};SoccerSlime.Mode=function(a){var d=g.menu;return function(c){if("undefined"===typeof c)for(var b in g)if(g[b]===d)return b;if("string"===typeof c)for(b in g)if(b===c){d=g[b];if(e.hasOwnProperty(b))e[b](a);return d}if("number"===typeof c)return d=c}};var e={menu:function(a){a.init();a.stage.menuLayer.setVisible(!0);a.stage.continueLayer.setVisible(!0);a.jumbotron.resetClock();a.jumbotron.stopClock();a.obj.stage.draw()},
goal:function(a){a.jumbotron.stopClock();a.stage.startTextAnimation("Goal!")},continueGame:function(a){a.init();a.jumbotron.stopClock();a.stage.menuLayer.setVisible(!1);a.stage.continueLayer.setVisible(!0)},game:function(a){a.jumbotron.startClock();a.stage.menuLayer.setVisible(!1);a.stage.continueLayer.setVisible(!1)},halfTime:function(a){a.jumbotron.stopClock();a.stage.startTextAnimation("2nd Half")}}})(jQuery);(function(f){SoccerSlime.Game()})(jQuery);
